<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
    <h1 class="h3 mb-2">Listado de Ventas</h1>
    <%= link_to "Nueva Venta", new_sale_path, class: "btn btn-primary mb-2" %>
  </div>

  <% if @sales.any? %>

    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Fecha</th>
            <th>Comprador</th>
            <th>Contacto</th>
            <th>Total</th>
            <th>Estado</th>
            <th>Vendido por</th>   <!-- üîµ Nueva columna -->
            <th class="text-center">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <% @sales.each do |sale| %>
            <tr>
              <td><%= sale.id %></td>
              <td><%= sale.sale_date&.strftime("%d/%m/%Y %H:%M") %></td>
              <td><%= sale.buyer_name %></td>
              <td><%= sale.buyer_contact.presence || "-" %></td>
              <td>$ <%= number_with_precision(sale.total, precision: 2) %></td>

              <td>
                <% if sale.cancelled? %>
                  <span class="badge bg-danger">Cancelado</span>
                <% else %>
                  <span class="badge bg-success">Activo</span>
                <% end %>
              </td>

              <!-- üîµ Mostrar email del usuario que hizo la venta -->
              <td>
                <%= sale.user&.email || "‚Äî" %>
              </td>

              <td class="text-center">

                <% unless sale.cancelled? %>
                  <%= form_with url: cancel_sale_path(sale), method: :put, class: "d-inline" do %>
                    <%= submit_tag "Cancelar",
                          data: { confirm: "¬øSeguro que deseas cancelar esta venta?" },
                          class: "btn btn-warning btn-sm mb-1" %>
                  <% end %>
                <% end %>
                <%= link_to "Ver Factura", invoice_sale_path(sale), class: "btn btn-info btn-sm", target: "_blank" %>
                <%= link_to "Descargar PDF", invoice_sale_path(sale, download: true), class: "btn btn-secondary btn-sm" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

  <% else %>
    <div class="alert alert-info">
      No hay ventas registradas a√∫n.
    </div>
  <% end %>
</div>
