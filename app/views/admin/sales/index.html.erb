<% content_for :admin_content do %>
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
    <h1 class="h3 mb-2">Listado de Ventas</h1>
    <%= link_to "Nueva Venta", new_admin_sale_path, class: "btn btn-primary mb-2" %>
  </div>

  <% if @sales.any? %>

    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Fecha</th>
            <th>Comprador</th>
            <th>DNI</th>
            <th>Contacto</th>
            <th>Total</th>
            <th>Estado</th>
            <th>Vendido por</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <% @sales.each do |sale| %>
            <tr>
              <td><%= sale.id %></td>
              <td><%= sale.sale_date&.strftime("%d/%m/%Y %H:%M") %></td>
              <td><%= sale.buyer_name %></td>

              <td><%= sale.buyer_id.presence || "-" %></td>

              <td><%= sale.buyer_contact.presence || "-" %></td>
              <td>$ <%= number_with_precision(sale.total, precision: 2) %></td>

              <td>
                <% if sale.cancelled? %>
                  <span class="badge bg-danger">Cancelado</span>
                <% else %>
                  <span class="badge bg-success">Activo</span>
                <% end %>
              </td>

              <td>
                <%= sale.user&.email || "—" %>
              </td>

              <td class="text-center">
                <% unless sale.cancelled? %>
                  <%= form_with url: cancel_admin_sale_path(sale), method: :put, class: "d-inline" do %>
                    <%= submit_tag "Cancelar",
                      data: { turbo_method: :put, turbo_confirm: "¿Seguro que deseas cancelar esta venta?" },
                      class: "btn btn-warning btn-sm" %>
                  <% end %>
                <% end %>

                <%= link_to "Ver Factura", invoice_admin_sale_path(sale), class: "btn btn-info btn-sm", target: "_blank" %>
                <%= link_to "Descargar PDF", invoice_admin_sale_path(sale, download: true), class: "btn btn-secondary btn-sm" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

  <% else %>
    <div class="alert alert-info">
      No hay ventas registradas aún.
    </div>
  <% end %>
</div>
<% end %>
