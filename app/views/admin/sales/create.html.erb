<% content_for :admin_content do %>
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3">Nueva Venta</h1>
    <%= link_to "Volver", sales_path, class: "btn btn-secondary" %>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">

      <%= form_with model: @sale, local: true do |f| %>

        <!-- Datos del comprador -->
        <h4 class="mb-3">Datos del Comprador</h4>
        <div class="row g-3">
          <div class="col-md-6">
            <%= f.label :buyer_name, "Nombre del comprador", class: "form-label" %>
            <%= f.text_field :buyer_name, class: "form-control", placeholder: "Ej: Juan Pérez" %>
          </div>

          <div class="col-md-6">
            <%= f.label :buyer_contact, "Contacto", class: "form-label" %>
            <%= f.text_field :buyer_contact, class: "form-control", placeholder: "Teléfono / Email" %>
          </div>

          <div class="col-md-6">
            <%= f.label :sale_date, "Fecha de la venta", class: "form-label" %>
            <%= f.datetime_select :sale_date, class: "form-control" %>
          </div>
        </div>

        <hr class="my-4">

        <!-- Items -->
        <h4 class="mb-3">Ítems de la Venta</h4>

        <div id="items-container">
          <%= f.fields_for :sale_items do |item| %>
            <div class="card p-3 mb-3 border">
              <div class="row g-3">
                <div class="col-md-4">
                  <%= item.label :product_name, "Producto", class: "form-label" %>
                  <%= item.text_field :product_name, class: "form-control", placeholder: "Ej: Taladro Bosch" %>
                </div>

                <div class="col-md-3">
                  <%= item.label :quantity, "Cantidad", class: "form-label" %>
                  <%= item.number_field :quantity, class: "form-control", min: 1 %>
                </div>

                <div class="col-md-3">
                  <%= item.label :price, "Precio", class: "form-label" %>
                  <%= item.number_field :price, class: "form-control", step: "0.01", placeholder: "0.00" %>
                </div>

                <div class="col-md-2 d-flex align-items-end">
                  <button class="btn btn-danger w-100 remove-item-btn" type="button">
                    Eliminar
                  </button>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <button type="button" class="btn btn-outline-primary mb-4" id="add-item-btn">
          + Agregar Ítem
        </button>

        <hr class="my-4">

        <!-- Total -->
        <div class="row mb-4">
          <div class="col-md-4">
            <%= f.label :total, "Total", class: "form-label" %>
            <%= f.number_field :total, class: "form-control", step: "0.01", placeholder: "0.00" %>
          </div>
        </div>

        <div class="text-end">
          <%= f.submit "Guardar Venta", class: "btn btn-primary btn-lg" %>
        </div>

      <% end %>
    </div>
  </div>
</div>
<% end %>
